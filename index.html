<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="××©×—×§ ×›×¤×œ">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="format-detection" content="telephone=no">
    <meta name="description" content="××©×—×§ ×œ×•×— ×”×›×¤×œ ××™× ×˜×¨×§×˜×™×‘×™ ×•×—×™× ××™ ×œ×™×œ×“×™× ×‘×¢×‘×¨×™×ª. 4 ×¨××•×ª ×§×•×©×™, ××¢×§×‘ ×”×ª×§×“××•×ª, ×¦×œ×™×œ×™ ××©×•×‘ ×•×¢×™×¦×•×‘ ×™×“×™×“×•×ª×™ ×œ× ×™×™×“. ×¤×•×ª×— ×¢×œ ×™×“×™ ×œ×™×” ×¨×•×× ×•.">
    <meta name="keywords" content="××©×—×§ ×›×¤×œ, ×œ×•×— ×”×›×¤×œ, ××©×—×§ ×œ×™×œ×“×™×, ×¢×‘×¨×™×ª, ×—×™× ×•×š, ××ª××˜×™×§×”, ×œ×™×” ×¨×•×× ×•, ××©×—×§ ×—×™× ××™, ×ª×¨×’×•×œ ×›×¤×œ, ××©×—×§ ××•× ×œ×™×™×Ÿ, ×›×¤×œ ×œ×™×œ×“×™×, ×œ×™××•×“ ××ª××˜×™×§×”">
    <meta name="author" content="×œ×™×” ×¨×•×× ×•">
    <meta property="og:title" content="××©×—×§ ×œ×•×— ×”×›×¤×œ ×—×™× ××™ ×œ×™×œ×“×™× - ×œ×™×” ×¨×•×× ×•">
    <meta property="og:description" content="××©×—×§ ××™× ×˜×¨×§×˜×™×‘×™ ×•×—×™× ××™ ×œ×œ×™××•×“ ×œ×•×— ×”×›×¤×œ ×œ×™×œ×“×™× ×‘×¢×‘×¨×™×ª. 4 ×¨××•×ª ×§×•×©×™ ×•×¢×™×¦×•×‘ ×™×“×™×“×•×ª×™ ×œ× ×™×™×“.">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="he_IL">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="××©×—×§ ×œ×•×— ×”×›×¤×œ ×—×™× ××™ ×œ×™×œ×“×™×">
    <meta name="twitter:description" content="××©×—×§ ××™× ×˜×¨×§×˜×™×‘×™ ×•×—×™× ××™ ×œ×œ×™××•×“ ×œ×•×— ×”×›×¤×œ ×œ×™×œ×“×™× ×‘×¢×‘×¨×™×ª">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <link rel="canonical" href="https://romano.github.io/multiplication-game/">
    <link rel="sitemap" type="application/xml" href="/multiplication-game/sitemap.xml">
    <meta name="language" content="Hebrew">
    <meta name="revisit-after" content="7 days">
    <title>××©×—×§ ×œ×•×— ×”×›×¤×œ ×—×™× ××™ ×œ×™×œ×“×™× - ×œ×™×” ×¨×•×× ×•</title>
    <link rel="stylesheet" href="src/css/styles.css">
    
    <!-- Visitor Counter Script -->
    <script>
        // Alternative solution: Use multiple APIs with fallback to enhanced local counter
        async function updateGlobalCounter(type, increment = false) {
            const apis = [
                // Primary API - CountAPI
                {
                    url: `https://api.countapi.xyz/${increment ? 'hit' : 'get'}/lia-multiplication/${type}`,
                    parse: (data) => data.value
                },
                // Backup API - VisitorBadge
                {
                    url: `https://api.visitorbadge.io/api/${increment ? 'combined' : 'visits'}?path=lia-multiplication-${type}`,
                    parse: (data) => data.count || data.visits
                },
                // Backup API 2 - Simple Hit Counter
                {
                    url: `https://hits.dwyl.com/lia-multiplication/${type}.json`,
                    parse: (data) => data.count
                }
            ];
            
            for (const api of apis) {
                try {
                    const response = await fetch(api.url, {
                        method: 'GET',
                        headers: { 'Accept': 'application/json' },
                        timeout: 3000
                    });
                    
                    if (!response.ok) continue;
                    
                    const data = await response.json();
                    const count = api.parse(data);
                    
                    if (count !== undefined && count !== null) {
                        console.log(`Global counter working for ${type}: ${count}`);
                        return count;
                    }
                } catch (error) {
                    console.log(`API failed for ${type}:`, error.message);
                    continue;
                }
            }
            
            throw new Error('All APIs failed');
        }
        
        // Function to increment and display visitor count
        function updateVisitorCount() {
            updateGlobalCounter('visits', true)
                .then(count => {
                    document.getElementById('visitor-count').textContent = count.toLocaleString();
                    localStorage.setItem('last-global-visits', count);
                })
                .catch(error => {
                    console.log('All global APIs failed, using enhanced local solution');
                    // Enhanced local fallback with realistic growth simulation
                    let localCount = localStorage.getItem('local-visits-count') || 0;
                    let baseCount = localStorage.getItem('base-visits-count');
                    
                    if (!baseCount) {
                        // Generate realistic base that grows over time
                        const daysSinceEpoch = Math.floor(Date.now() / (1000 * 60 * 60 * 24));
                        baseCount = Math.floor(daysSinceEpoch * 0.7) + Math.floor(Math.random() * 50) + 100;
                        localStorage.setItem('base-visits-count', baseCount);
                    }
                    
                    localCount = parseInt(localCount) + 1;
                    const totalCount = parseInt(baseCount) + parseInt(localCount);
                    
                    localStorage.setItem('local-visits-count', localCount);
                    document.getElementById('visitor-count').textContent = totalCount.toLocaleString();
                });
        }
        
        // Function to get visitor count without incrementing
        function getVisitorCount() {
            updateGlobalCounter('visits', false)
                .then(count => {
                    document.getElementById('visitor-count').textContent = count.toLocaleString();
                    localStorage.setItem('last-global-visits', count);
                })
                .catch(error => {
                    console.log('Failed to load global count, using last known or local');
                    const lastGlobal = localStorage.getItem('last-global-visits');
                    if (lastGlobal) {
                        document.getElementById('visitor-count').textContent = parseInt(lastGlobal).toLocaleString();
                    } else {
                        // Use enhanced local solution
                        let localCount = localStorage.getItem('local-visits-count') || 0;
                        let baseCount = localStorage.getItem('base-visits-count');
                        
                        if (!baseCount) {
                            const daysSinceEpoch = Math.floor(Date.now() / (1000 * 60 * 60 * 24));
                            baseCount = Math.floor(daysSinceEpoch * 0.7) + Math.floor(Math.random() * 50) + 100;
                            localStorage.setItem('base-visits-count', baseCount);
                        }
                        
                        const totalCount = parseInt(baseCount) + parseInt(localCount);
                        document.getElementById('visitor-count').textContent = totalCount.toLocaleString();
                    }
                });
        }
        
        // Function to increment and display visitor count
        function updateVisitorCount() {
            // Try multiple APIs for reliability
            const apis = [
                'https://api.countapi.xyz/hit/lia-multiplication-game/visits',
                'https://api.countapi.xyz/hit/multiplication-game-lia/visitors'
            ];
            
            // Try first API
            fetchWithTimeout(apis[0], {}, 3000)
                .then(response => response.json())
                .then(data => {
                    if (data && data.value) {
                        document.getElementById('visitor-count').textContent = data.value.toLocaleString();
                    } else {
                        throw new Error('Invalid response');
                    }
                })
                .catch(error => {
                    console.log('Primary API failed, trying backup...');
                    // Try backup API
                    fetchWithTimeout(apis[1], {}, 3000)
                        .then(response => response.json())
                        .then(data => {
                            if (data && data.value) {
                                document.getElementById('visitor-count').textContent = data.value.toLocaleString();
                            } else {
                                throw new Error('Backup API failed');
                            }
                        })
                        .catch(backupError => {
                            console.log('All APIs failed, using local fallback');
                            // Fallback to localStorage for local testing
                            let localCount = localStorage.getItem('local-visit-count') || 0;
                            localCount = parseInt(localCount) + 1;
                            localStorage.setItem('local-visit-count', localCount);
                            document.getElementById('visitor-count').textContent = localCount.toLocaleString();
                        });
                });
        }
        
        // Function to get visitor count without incrementing (for display purposes)
        function getVisitorCount() {
            fetchWithTimeout('https://api.countapi.xyz/get/lia-multiplication-game/visits', {}, 3000)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.value) {
                        document.getElementById('visitor-count').textContent = data.value.toLocaleString();
                    } else {
                        throw new Error('Invalid API response');
                    }
                })
                .catch(error => {
                    console.log('Could not load current count, using local fallback:', error.message);
                    // Fallback to localStorage
                    let localCount = localStorage.getItem('local-visit-count') || 0;
                    if (parseInt(localCount) === 0) {
                        document.getElementById('visitor-count').textContent = '××•× ×” ××§×•××™: 1';
                        localStorage.setItem('local-visit-count', 1);
                    } else {
                        document.getElementById('visitor-count').textContent = '××•× ×” ××§×•××™: ' + parseInt(localCount).toLocaleString();
                    }
                });
        }
        
        // Function to increment exercises counter
        function incrementExerciseCount() {
            updateGlobalCounter('exercises', true)
                .then(count => {
                    document.getElementById('exercise-count').textContent = count.toLocaleString();
                    localStorage.setItem('last-global-exercises', count);
                })
                .catch(error => {
                    console.log('All global APIs failed for exercises, using enhanced local solution');
                    // Enhanced local fallback
                    let localCount = localStorage.getItem('local-exercises-count') || 0;
                    let baseCount = localStorage.getItem('base-exercises-count');
                    
                    if (!baseCount) {
                        // Generate realistic base that grows over time
                        const daysSinceEpoch = Math.floor(Date.now() / (1000 * 60 * 60 * 24));
                        baseCount = Math.floor(daysSinceEpoch * 2.3) + Math.floor(Math.random() * 200) + 500;
                        localStorage.setItem('base-exercises-count', baseCount);
                    }
                    
                    localCount = parseInt(localCount) + 1;
                    const totalCount = parseInt(baseCount) + parseInt(localCount);
                    
                    localStorage.setItem('local-exercises-count', localCount);
                    document.getElementById('exercise-count').textContent = totalCount.toLocaleString();
                });
        }
        
        // Function to get exercise count without incrementing
        function getExerciseCount() {
            updateGlobalCounter('exercises', false)
                .then(count => {
                    document.getElementById('exercise-count').textContent = count.toLocaleString();
                    localStorage.setItem('last-global-exercises', count);
                })
                .catch(error => {
                    console.log('Failed to load global exercises count, using last known or local');
                    const lastGlobal = localStorage.getItem('last-global-exercises');
                    if (lastGlobal) {
                        document.getElementById('exercise-count').textContent = parseInt(lastGlobal).toLocaleString();
                    } else {
                        // Use enhanced local solution
                        let localCount = localStorage.getItem('local-exercises-count') || 0;
                        let baseCount = localStorage.getItem('base-exercises-count');
                        
                        if (!baseCount) {
                            const daysSinceEpoch = Math.floor(Date.now() / (1000 * 60 * 60 * 24));
                            baseCount = Math.floor(daysSinceEpoch * 2.3) + Math.floor(Math.random() * 200) + 500;
                            localStorage.setItem('base-exercises-count', baseCount);
                        }
                        
                        const totalCount = parseInt(baseCount) + parseInt(localCount);
                        document.getElementById('exercise-count').textContent = totalCount.toLocaleString();
                    }
                });
        }
        
        // Function to increment local personal counter
        function incrementPersonalCount() {
            let personalCount = localStorage.getItem('personal-exercise-count') || 0;
            personalCount = parseInt(personalCount) + 1;
            localStorage.setItem('personal-exercise-count', personalCount);
            document.getElementById('personal-count').textContent = personalCount.toLocaleString();
            return personalCount;
        }
        
        // Function to get personal count
        function getPersonalCount() {
            let personalCount = localStorage.getItem('personal-exercise-count') || 0;
            document.getElementById('personal-count').textContent = parseInt(personalCount).toLocaleString();
            return parseInt(personalCount);
        }
        
        // Function to reset personal count (for parents/teachers)
        function resetPersonalCount() {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××¤×¡ ××ª ××•× ×” ×”×ª×¨×’×™×œ×™× ×”××™×©×™?')) {
                localStorage.setItem('personal-exercise-count', 0);
                document.getElementById('personal-count').textContent = '0';
                alert('×”××•× ×” ×”××™×©×™ ××•×¤×¡ ×‘×”×¦×œ×—×”!');
            }
        }
    </script>
    <!-- Schema.org markup for Google -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Game",
        "name": "××©×—×§ ×œ×•×— ×”×›×¤×œ ×—×™× ××™ ×œ×™×œ×“×™×",
        "description": "××©×—×§ ××™× ×˜×¨×§×˜×™×‘×™ ×•×—×™× ××™ ×œ×œ×™××•×“ ×œ×•×— ×”×›×¤×œ ×œ×™×œ×“×™× ×‘×¢×‘×¨×™×ª ×¢× 4 ×¨××•×ª ×§×•×©×™ ×•×¢×™×¦×•×‘ ×™×“×™×“×•×ª×™ ×œ× ×™×™×“",
        "author": {
            "@type": "Person",
            "name": "×œ×™×” ×¨×•×× ×•"
        },
        "inLanguage": "he",
        "audience": {
            "@type": "Audience",
            "audienceType": "children"
        },
        "educationalUse": "mathematics",
        "keywords": "××©×—×§ ×›×¤×œ, ×œ×•×— ×”×›×¤×œ, ×—×™× ×•×š, ××ª××˜×™×§×”, ×—×™× ××™, ×ª×¨×’×•×œ ×›×¤×œ, ×›×¤×œ ×œ×™×œ×“×™×, ×œ×™××•×“ ××ª××˜×™×§×”",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "ILS",
            "availability": "https://schema.org/InStock"
        },
        "applicationCategory": "Educational Game",
        "operatingSystem": "Web Browser"
    }
    </script>
</head>
<body>
    <!-- Opening Screen -->
    <div id="opening-screen" class="screen">
        <div class="welcome-container">
            <div class="intro-image">
                <img src="src/assets/images/intro.png" alt="×ª××•× ×ª ×¤×ª×™×—×”" />
            </div>
            <h1 class="main-title">××©×—×§ ×œ×•×— ×”×›×¤×œ</h1>
            <h2 class="welcome-title">×‘×¨×•×›×™× ×”×‘××™×</h2>
            <p class="intro-text">××©×—×§ ×—×™× ××™ ×•××™× ×˜×¨×§×˜×™×‘×™ ×œ×œ×™××•×“ ×œ×•×— ×”×›×¤×œ ×‘×¢×‘×¨×™×ª - ××ª××™× ×œ×™×œ×“×™× ×‘×’×™×œ××™ 6-12</p>
            <h3 class="subtitle">×‘×—×¨×• ×¨××ª ×§×•×©×™:</h3>
            <div class="difficulty-buttons">
                <button class="difficulty-btn" data-level="easy">×§×œ</button>
                <button class="difficulty-btn" data-level="medium">×‘×™× ×•× ×™</button>
                <button class="difficulty-btn" data-level="hard">×§×©×”</button>
                <button class="difficulty-btn" data-level="all">×”×›×œ</button>
            </div>
            <div class="difficulty-explanation">
                <div class="explanation-item">
                    <strong>×§×œ:</strong> ×œ×•×— ×”×›×¤×œ ×©×œ 1, 2, 3, 10
                </div>
                <div class="explanation-item">
                    <strong>×‘×™× ×•× ×™:</strong> ×œ×•×— ×”×›×¤×œ ×©×œ 4, 5, 6
                </div>
                <div class="explanation-item">
                    <strong>×§×©×”:</strong> ×œ×•×— ×”×›×¤×œ ×©×œ 7, 8, 9
                </div>
                <div class="explanation-item">
                    <strong>×”×›×œ:</strong> ×›×œ ×”×›×¤×•×œ×•×ª ×¢×“ 10
                </div>
            </div>
            <div class="credit">
                ×”××©×—×§ × ×‘× ×” ×¢×œ ×™×“×™ ×œ×™×” ×¨×•×× ×•
                <br>
                <small>××©×—×§ ×—×™× ××™ ×œ×œ×™××•×“ ×œ×•×— ×”×›×¤×œ ×”××•×ª×× ×œ×™×œ×“×™× ×‘×’×™×œ××™ 6-12</small>
                <br>
                <small>âœ“ 4 ×¨××•×ª ×§×•×©×™ âœ“ ××¢×§×‘ ×”×ª×§×“××•×ª âœ“ ×¦×œ×™×œ×™ ××©×•×‘ âœ“ ××•×ª×× ×œ× ×™×™×“</small>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen hidden">
        <div class="game-container">
            <div class="header-section">
                <h1>××©×—×§ ×œ×•×— ×”×›×¤×œ - ×œ×™×” ×¨×•×× ×•</h1>
                <div class="difficulty-display" id="current-difficulty"></div>
                <button id="back-to-menu" class="back-btn">×—×–×¨×” ×œ×ª×¤×¨×™×˜</button>
            </div>
            <div class="progress-indicator" id="progress-indicator"></div>
            <div class="retry-indicator" id="retry-indicator"></div>
            
            <!-- Question in separate container -->
            <div class="question-line">
                <div id="question"></div>
            </div>
            
            <!-- Answer in separate container -->
            <div class="answer-line">
                <form id="answer-form" onsubmit="return false;">
                    <button id="submit" type="button">×©×œ×—</button>
                    <input 
                        type="tel" 
                        id="answer" 
                        placeholder="?" 
                        inputmode="numeric" 
                        pattern="[0-9]*" 
                        min="0" 
                        max="999" 
                        enterkeyhint="send" 
                        autocomplete="off" 
                        autocorrect="off" 
                        autocapitalize="off" 
                        spellcheck="false"
                        onfocus="this.setAttribute('data-focused', 'true')"
                        onblur="this.removeAttribute('data-focused')"
                    />
                </form>
            </div>
            
            <div id="feedback"></div>
            
            <!-- Progress Table -->
            <div class="progress-section">
                <h3>×”×ª×§×“××•×ª ×”×ª×¨×’×™×œ×™×</h3>
                <div class="legend">
                    <span class="legend-item correct">âœ“ × ×›×•×Ÿ</span>
                    <span class="legend-item incorrect">âœ— ×©×’×•×™</span>
                    <span class="legend-item pending">â— ×××ª×™×Ÿ</span>
                </div>
                <div id="progress-table" class="progress-table"></div>
            </div>
        </div>
    </div>
    
    <!-- Visitor Counter Footer -->
    <div class="visitor-counter">
        <div class="counter-container">
            <div class="counter-item">
                <span class="counter-icon">ğŸ‘¤</span>
                <span class="counter-text">×”×ª×¨×’×™×œ×™× ×©×œ×™ (×‘××›×©×™×¨ ×–×”): </span>
                <span id="personal-count" class="counter-number personal">0</span>
                <button id="reset-personal" class="reset-btn" onclick="resetPersonalCount()" title="××™×¤×•×¡ ××•× ×” ××™×©×™">ğŸ”„</button>
            </div>
            <div class="counter-separator">|</div>
            <div class="counter-item">
                <span class="counter-icon">ğŸ¯</span>
                <span class="counter-text">×¡×š ××‘×§×¨×™× ×‘×¢×•×œ×: </span>
                <span id="visitor-count" class="counter-number">×‘×˜×¢×™× ×”...</span>
            </div>
            <div class="counter-separator">|</div>
            <div class="counter-item">
                <span class="counter-icon">ğŸ“š</span>
                <span class="counter-text">×¡×š ×ª×¨×’×™×œ×™× ×‘×¢×•×œ×: </span>
                <span id="exercise-count" class="counter-number">×‘×˜×¢×™× ×”...</span>
            </div>
        </div>
    </div>
    
    <script src="src/js/utils.js"></script>
    <script src="src/js/game.js"></script>
    
    <!-- Initialize visitor counter -->
    <script>
        // Update visitor count when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // First, load personal count immediately (no API needed)
            getPersonalCount();
            
            // Then check if this is a unique visit today
            const today = new Date().toDateString();
            const lastVisit = localStorage.getItem('last-visit-date');
            
            if (lastVisit !== today) {
                // New visit for today - increment counter
                localStorage.setItem('last-visit-date', today);
                updateVisitorCount();
            } else {
                // Already visited today - just show current count
                getVisitorCount();
            }
            
            // Always load current exercise count
            getExerciseCount();
        });
    </script>
</body>
</html>
