<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="משחק כפל">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="format-detection" content="telephone=no">
    <meta name="description" content="משחק לוח הכפל אינטרקטיבי וחינמי לילדים בעברית. 4 רמות קושי, מעקב התקדמות, צלילי משוב ועיצוב ידידותי לנייד. פותח על ידי ליה רומנו.">
    <meta name="keywords" content="משחק כפל, לוח הכפל, משחק לילדים, עברית, חינוך, מתמטיקה, ליה רומנו, משחק חינמי, תרגול כפל, משחק אונליין, כפל לילדים, לימוד מתמטיקה">
    <meta name="author" content="ליה רומנו">
    <meta property="og:title" content="משחק לוח הכפל חינמי לילדים - ליה רומנו">
    <meta property="og:description" content="משחק אינטרקטיבי וחינמי ללימוד לוח הכפל לילדים בעברית. 4 רמות קושי ועיצוב ידידותי לנייד.">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="he_IL">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="משחק לוח הכפל חינמי לילדים">
    <meta name="twitter:description" content="משחק אינטרקטיבי וחינמי ללימוד לוח הכפל לילדים בעברית">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <link rel="canonical" href="https://romano.github.io/multiplication-game/">
    <link rel="sitemap" type="application/xml" href="/multiplication-game/sitemap.xml">
    <meta name="language" content="Hebrew">
    <meta name="revisit-after" content="7 days">
    <title>משחק לוח הכפל חינמי לילדים - ליה רומנו</title>
    <link rel="stylesheet" href="src/css/styles.css">
    
    <!-- 
    Multiple Counter Services Setup - CONFIGURED ✅
    Primary: CountAPI (your token: ut_Atq7mcamb6t6FQ00FYPC7rNfu1xzS5at05KRgiP7)
    Backup: HitCounter (public API)
    The system will try each service until one works!
    -->
    
    <!-- Counter Scripts -->
    <script>
        // Multiple counter service configurations for reliability
        const COUNTER_SERVICES = [
            {
                name: 'CountAPI',
                namespace: 'lia-multiplication-game-v2',
                getUrl: (key) => `https://api.countapi.xyz/get/lia-multiplication-game-v2/${key}`,
                hitUrl: (key) => `https://api.countapi.xyz/hit/lia-multiplication-game-v2/${key}`,
                parseValue: (data) => data?.value
            },
            {
                name: 'HitCounter',
                namespace: 'lia-multiplication-game',
                getUrl: (key) => `https://api.hitcounter.io/api/get/${key}`,
                hitUrl: (key) => `https://api.hitcounter.io/api/hit/${key}`,
                parseValue: (data) => data?.count
            }
        ];
        
        // Helper function for fetch with timeout
        function fetchWithTimeout(url, options = {}, timeout = 5000) {
            console.log('Making request to:', url);
            
            return Promise.race([
                fetch(url, options),
                new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Timeout')), timeout)
                )
            ]);
        }
        
        // Try multiple services until one works
        async function tryCounterServices(action, key = 'visitors') {
            for (const service of COUNTER_SERVICES) {
                try {
                    console.log(`Trying ${service.name} service...`);
                    const url = action === 'hit' ? service.hitUrl(key) : service.getUrl(key);
                    
                    const response = await fetchWithTimeout(url, {}, 3000);
                    console.log(`${service.name} response status:`, response.status);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log(`${service.name} response data:`, data);
                    
                    const value = service.parseValue(data);
                    if (typeof value === 'number') {
                        console.log(`${service.name} worked! Value:`, value);
                        return value;
                    } else {
                        throw new Error('Invalid response format');
                    }
                } catch (error) {
                    console.log(`${service.name} failed:`, error.message);
                    continue;
                }
            }
            throw new Error('All counter services failed');
        }
        
        // Function to update global visitor count
        async function updateGlobalVisitorCount() {
            try {
                console.log('Attempting to update visitor count...');
                const count = await tryCounterServices('hit', 'visitors');
                document.getElementById('global-visitor-count').textContent = count.toLocaleString();
                console.log('Visitor count updated successfully:', count);
            } catch (error) {
                console.error('Failed to update visitor count:', error.message);
                // Show helpful message based on the environment
                if (window.location.protocol === 'file:') {
                    document.getElementById('global-visitor-count').textContent = 'יעבוד כשהאתר אונליין';
                } else {
                    document.getElementById('global-visitor-count').textContent = 'לא זמין';
                }
            }
        }
        
        // Function to get current visitor count (without incrementing)
        async function getGlobalVisitorCount() {
            try {
                console.log('Attempting to get visitor count...');
                const count = await tryCounterServices('get', 'visitors');
                document.getElementById('global-visitor-count').textContent = count.toLocaleString();
                console.log('Visitor count retrieved successfully:', count);
            } catch (error) {
                console.error('Failed to get visitor count:', error.message);
                // Show helpful message based on the environment
                if (window.location.protocol === 'file:') {
                    document.getElementById('global-visitor-count').textContent = 'יעבוד כשהאתר אונליין';
                } else {
                    document.getElementById('global-visitor-count').textContent = 'לא זמין';
                }
            }
        }
        
        // Function to increment local personal counter
        function incrementPersonalCount() {
            let personalCount = localStorage.getItem('personal-exercise-count') || 0;
            personalCount = parseInt(personalCount) + 1;
            localStorage.setItem('personal-exercise-count', personalCount);
            document.getElementById('personal-count').textContent = personalCount.toLocaleString();
            return personalCount;
        }
        
        // Function to get personal count
        function getPersonalCount() {
            let personalCount = localStorage.getItem('personal-exercise-count') || 0;
            document.getElementById('personal-count').textContent = parseInt(personalCount).toLocaleString();
            return parseInt(personalCount);
        }
        
        // Function to reset personal count (for parents/teachers)
        function resetPersonalCount() {
            if (confirm('האם אתה בטוח שברצונך לאפס את מונה התרגילים האישי?')) {
                localStorage.setItem('personal-exercise-count', 0);
                document.getElementById('personal-count').textContent = '0';
                alert('המונה האישי אופס בהצלחה!');
            }
        }
    </script>
    <!-- Schema.org markup for Google -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Game",
        "name": "משחק לוח הכפל חינמי לילדים",
        "description": "משחק אינטרקטיבי וחינמי ללימוד לוח הכפל לילדים בעברית עם 4 רמות קושי ועיצוב ידידותי לנייד",
        "author": {
            "@type": "Person",
            "name": "ליה רומנו"
        },
        "inLanguage": "he",
        "audience": {
            "@type": "Audience",
            "audienceType": "children"
        },
        "educationalUse": "mathematics",
        "keywords": "משחק כפל, לוח הכפל, חינוך, מתמטיקה, חינמי, תרגול כפל, כפל לילדים, לימוד מתמטיקה",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "ILS",
            "availability": "https://schema.org/InStock"
        },
        "applicationCategory": "Educational Game",
        "operatingSystem": "Web Browser"
    }
    </script>
</head>
<body>
    <!-- Opening Screen -->
    <div id="opening-screen" class="screen">
        <div class="welcome-container">
            <div class="intro-image">
                <img src="src/assets/images/intro.png" alt="תמונת פתיחה" />
            </div>
            <h1 class="main-title">משחק לוח הכפל</h1>
            <h2 class="welcome-title">ברוכים הבאים</h2>
            <p class="intro-text">משחק חינמי ואינטרקטיבי ללימוד לוח הכפל בעברית - מתאים לילדים בגילאי 6-12</p>
            <h3 class="subtitle">בחרו רמת קושי:</h3>
            <div class="difficulty-buttons">
                <button class="difficulty-btn" data-level="easy">קל</button>
                <button class="difficulty-btn" data-level="medium">בינוני</button>
                <button class="difficulty-btn" data-level="hard">קשה</button>
                <button class="difficulty-btn" data-level="all">הכל</button>
            </div>
            <div class="difficulty-explanation">
                <div class="explanation-item">
                    <strong>קל:</strong> לוח הכפל של 1, 2, 3, 10
                </div>
                <div class="explanation-item">
                    <strong>בינוני:</strong> לוח הכפל של 4, 5, 6
                </div>
                <div class="explanation-item">
                    <strong>קשה:</strong> לוח הכפל של 7, 8, 9
                </div>
                <div class="explanation-item">
                    <strong>הכל:</strong> כל הכפולות עד 10
                </div>
            </div>
            <div class="credit">
                המשחק נבנה על ידי ליה רומנו
                <br>
                <small>משחק חינמי ללימוד לוח הכפל המותאם לילדים בגילאי 6-12</small>
                <br>
                <small>✓ 4 רמות קושי ✓ מעקב התקדמות ✓ צלילי משוב ✓ מותאם לנייד</small>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen hidden">
        <div class="game-container">
            <div class="header-section">
                <h1>משחק לוח הכפל - ליה רומנו</h1>
                <div class="difficulty-display" id="current-difficulty"></div>
                <button id="back-to-menu" class="back-btn">חזרה לתפריט</button>
            </div>
            <div class="progress-indicator" id="progress-indicator"></div>
            <div class="retry-indicator" id="retry-indicator"></div>
            
            <!-- Question in separate container -->
            <div class="question-line">
                <div id="question"></div>
            </div>
            
            <!-- Answer in separate container -->
            <div class="answer-line">
                <form id="answer-form" onsubmit="return false;">
                    <button id="submit" type="button">שלח</button>
                    <input 
                        type="tel" 
                        id="answer" 
                        placeholder="?" 
                        inputmode="numeric" 
                        pattern="[0-9]*" 
                        min="0" 
                        max="999" 
                        enterkeyhint="send" 
                        autocomplete="off" 
                        autocorrect="off" 
                        autocapitalize="off" 
                        spellcheck="false"
                        onfocus="this.setAttribute('data-focused', 'true')"
                        onblur="this.removeAttribute('data-focused')"
                    />
                </form>
            </div>
            
            <div id="feedback"></div>
            
            <!-- Progress Table -->
            <div class="progress-section">
                <h3>התקדמות התרגילים</h3>
                <div class="legend">
                    <span class="legend-item correct">✓ נכון</span>
                    <span class="legend-item incorrect">✗ שגוי</span>
                    <span class="legend-item pending">● ממתין</span>
                </div>
                <div id="progress-table" class="progress-table"></div>
            </div>
        </div>
    </div>
    
    <!-- Visitor Counter Footer -->
    <div class="visitor-counter">
        <div class="counter-container">
            <div class="counter-item">
                <span class="counter-icon">👤</span>
                <span class="counter-text">התרגילים שלי (במכשיר זה): </span>
                <span id="personal-count" class="counter-number personal">0</span>
                <button id="reset-personal" class="reset-btn" onclick="resetPersonalCount()" title="איפוס מונה אישי">🔄</button>
            </div>
            <div class="counter-separator">|</div>
            <div class="counter-item">
                <span class="counter-icon">🌍</span>
                <span class="counter-text">מבקרים בעולם: </span>
                <span id="global-visitor-count" class="counter-number">בטעינה...</span>
            </div>
        </div>
    </div>
    
    <script src="src/js/utils.js"></script>
    <script src="src/js/game.js"></script>
    
    <!-- Initialize counters -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize personal count immediately
            getPersonalCount();
            
            // Handle visitor count - only count unique daily visits
            const today = new Date().toDateString();
            const lastVisit = localStorage.getItem('last-visit-date');
            
            if (lastVisit !== today) {
                // New unique visit for today - increment global counter
                localStorage.setItem('last-visit-date', today);
                updateGlobalVisitorCount();
            } else {
                // Already visited today - just show current count
                getGlobalVisitorCount();
            }
        });
    </script>
</body>
</html>
